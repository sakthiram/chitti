# Multi-Agent Orchestrator Skill

Orchestrate autonomous agent teams to complete complex tasks with minimal human intervention.

## What This Skill Does

- PM agent **dynamically selects** which specialized agents are needed based on task classification
- Agent catalog provides available agents (explore, plan, architect, dev, test, review)
- Signal-based decisions (no hardcoded timeouts)
- Persistent agent sessions with follow-up instructions
- Remote coding support (dev/architect via SSH) with single remote tmux session per task
- Standardized handoff documents for agent communication
- **Non-negotiable principles** enforced (review always, human plan review, plan usually)
- PM maintains progress.md (single source of truth for task status)
- Supports both Claude and Kiro CLI

## Quick Start

```bash
# 1. Setup agents for your project
./scripts/setup-agents /path/to/project

# 2. Start a new task
./scripts/task start my-feature

# 3. Check status
./scripts/task status my-feature

# 4. Trigger PM check-in
./scripts/pm-check-in.sh my-feature

# 5. Attach to PM session
./scripts/task attach my-feature

# 6. Stop task
./scripts/task stop my-feature
```

## Project Structure

```
<project>/
├── .claude/agents/       # Claude agent files (*.md)
├── .kiro/agents/         # Kiro agent files (*.json)
├── tasks/{task-name}/
│   ├── task.md           # Requirements + agent config
│   ├── pm_state.json     # PM tracking state
│   ├── progress.md       # PM's status summary
│   ├── handoffs/         # Agent communication
│   └── artifacts/        # Generated outputs
└── .claude/skills/       # Project-specific skills
```

## Key Concepts

### Agent Catalog

Before starting tasks, generate the agent catalog:
```bash
./scripts/setup-agents /path/to/project
```

Creates both `.claude/agents/*.md` and `.kiro/agents/*.json`. This is a **one-time setup** that creates all available agents the PM can choose from. Existing agents are skipped.

**After bootstrap, customize freely:**
- Edit prompts to adjust agent behavior
- Add project-specific agents
- Modify tools, model, or skills

### Dynamic Agent Selection

PM dynamically selects agents based on:

1. **Task Classification** - Complexity (low/medium/high), Type (feature/bugfix/refactor/research/hotfix), Scope, Familiarity
2. **Non-Negotiable Principles**:
   - **Validate & Iterate** - Review agent ALWAYS runs
   - **Document Decisions** - PM updates progress.md
   - **Plan Before Code** - Plan agent unless trivial
   - **Human Review of Plan** - PM pauses for human approval
   - **Design Before Build** - Architect when needed

PM documents selection rationale in `pm_state.json`, including why agents were selected or skipped.

### Handoff Documents

Agents communicate via timestamped handoff files:
- `research-20251127-090000.md` (explore output)
- `plan-20251127-100000.md` (plan output)
- `PR-iter1-20251127-120000.md` (dev iteration 1)
- `pm-to-dev-20251127-170000.md` (PM instructions)

### Agent Config in task.md

```yaml
dev:
  cwd: user@host:/remote/path    # Remote coding
  skills: [project-skill]

test:
  cwd: /local/path               # Device access is local
  skills: [device-access]
```

### PM Check-in Flow

1. PM reads new handoffs (by mtime)
2. PM updates progress.md
3. PM decides next action (spawn agent, send follow-up, escalate)

Set up cron for periodic check-ins:
```bash
*/10 * * * * /path/to/scripts/pm-check-in.sh my-task
```

## Documentation

- `SKILL.md` - Complete skill reference
- `docs/PRFAQ-Agent-Orchestrator.md` - Product vision
- `docs/Implementation-Agent-Orchestrator.md` - Technical design
- `docs/Implementation-Plan.md` - Implementation roadmap
- `references/decision-protocols.md` - PM decision framework

## Scripts

| Script | Purpose |
|--------|---------|
| `setup-agents` | Generate agent files for project |
| `task` | Main CLI (create, start, status, stop, attach, logs) |
| `spawn_agent.sh` | Spawn agent (local or remote). `--handoff` and `--cli` are REQUIRED |
| `send_to_agent.sh` | Send follow-up to local agent |
| `send_to_remote_agent.sh` | Send follow-up to remote agent via SSH |
| `sync_from_remote.sh` | Pull handoffs/artifacts from remote (REQUIRED after remote agent completes) |
| `pm-check-in.sh` | Trigger PM check-in |

## Agent Files

Agents are static files generated by `setup-agents`:
- Claude: `.claude/agents/<agent>.md` (Markdown with YAML frontmatter)
- Kiro: `.kiro/agents/<agent>.json` (JSON format)

PM can create new agents by writing to these directories.
